<!DOCTYPE html>
<html>

<body>

	<p>Click the button to get your coordinates.</p>

	<form action="POST" onsubmit="getLocation()">
		<label for="prod">Product:</label>
		<input type="text" id="prod">
		<label for="cat">Category:</label>
		<input type="text" id="cat">
		<label for="rad">Radius:</label>
		<input type="text" id="rad">
		<label for="opennow">Open Now:</label>
		<input type="text" id="opennow">
		<button type="submit" value="Submit" id="button">Submit</button>

	</form>
	<button onclick="getLocation()" id="button">Normal Try It</button>

	<p id="demo"></p>
	<p id="demo2"></p>



	<script>
		var x = document.getElementById("demo");
		
		let pos;

		function showPosition(position) {
			// async action 
			const lat = position.coords.latitude;
			const lng = position.coords.longitude;
			const prod = document.getElementById("prod")
			const cat = document.getElementById("cat")
			const rad = document.getElementById("rad")
			const now = document.getElementById("opennow")


			// x.innerHTML = "Latitude: " + lat +
			//   "<br>Longitude: " + lng;

			pos = [lat, lng];
			console.log(pos);

			entry = {
				lat: lat,
				lng: lng,
				prod: prod.value,
				cat: cat.value,
				rad: rad.value,
				now: now.value,
			}

			fetch(`${window.origin}/`, {
					method: "POST",
					credentials: "include", // any cookies on page
					body: JSON.stringify(entry),
					cache: "no-cache",
					headers: new Headers({
						"content-type": "application/json"
					})
				}) //takes url or place to take data from, and init constructor
				.then(function (response) {
					if (response.status !== 200) {
						console.log(`Looks like there was a problem. Status code: ${response.status}`);
						return;
					}
					response.json().then(function (data) {
						console.log(data);
					});
				})
				.catch(function (error) {
					console.log("Fetch error: " + error);
				});
		}

		function getLocation() {

			event.preventDefault();

			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				x.innerHTML = "Geolocation is not supported by this browser.";
			}
		}
	</script>

</body>

</html>